(function () { $.fn.popbox = function (options) { var settings = $.extend({ selector: this.selector, open: ".open", box: ".box", arrow: ".popbox-arrow", arrow_border: ".arrow-border", close: ".close", closefunction: "0" }, options); var methods = { open: function (e) { e.preventDefault(); var t = $(this); var n = $(this).parent().find(settings["box"]); var r = t.parent().find(settings["open"]); n.find(settings["arrow"]).css({ left: 10 }); n.find(settings["arrow_border"]).css({ left: 10 }); if (n.css("display") == "block") { methods.close() } else { n.css({ display: "block", top: 10, left: r.width() / 2, width: n.width() + 3 }) } }, close: function () { if ($(settings["box"]).css("display") == "block" && settings["closefunction"] != "") { var fn = settings["closefunction"]; try { eval(fn)() } catch (ex) { } } $(settings["box"]).fadeOut("fast") } }; $(document).bind("keyup", function (e) { if (e.keyCode == 27) { methods.close() } }); $(document).bind("click", function (e) { if (!$(e.target).closest(settings["selector"]).length) { methods.close() } }); return this.each(function () { $(this).css({ width: $(settings["box"]).width() + $(settings["box"]).width() / 2 }); $(settings["open"], this).bind("click", methods.open); $(settings["open"], this).parent().find(settings["close"]).bind("click", function (e) { e.preventDefault(); methods.close() }) }) } }).call(this)